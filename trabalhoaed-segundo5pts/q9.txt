using System;
using System.Collections;

namespace AED
{
    public class CCelulaDup<T>
    {
        public T Item;
        public CCelulaDup<T> Ant;
        public CCelulaDup<T> Prox;

        public CCelulaDup()
        {
            Item = default(T);
            Ant = null;
            Prox = null;
        }

        public CCelulaDup(T valorItem)
        {
            Item = valorItem;
            Ant = null;
            Prox = null;
        }

        public CCelulaDup(T valorItem, CCelulaDup<T> celulaAnt, CCelulaDup<T> proxCelula)
        {
            Item = valorItem;
            Ant = celulaAnt;
            Prox = proxCelula;
        }
    }

    public class CListaDup<T> : IEnumerable<T>
    {
        private CCelulaDup<T> Primeira;
        private CCelulaDup<T> Ultima;
        private int Qtde = 0;

        public CListaDup()
        {
            Primeira = new CCelulaDup<T>();
            Ultima = Primeira;
        }

        public bool Vazia() => Primeira == Ultima;

        public void InsereFim(T valorItem)
        {
            Ultima.Prox = new CCelulaDup<T>(valorItem, Ultima, null);
            Ultima = Ultima.Prox;
            Qtde++;
        }

        public void InsereComeco(T valorItem)
        {
            if (Primeira == Ultima)
            {
                Ultima.Prox = new CCelulaDup<T>(valorItem, Ultima, null);
                Ultima = Ultima.Prox;
            }
            else
            {
                Primeira.Prox = new CCelulaDup<T>(valorItem, Primeira, Primeira.Prox);
                Primeira.Prox.Prox.Ant = Primeira.Prox;
            }
            Qtde++;
        }

        public void RemoveComecoSemRetorno()
        {
            if (Primeira != Ultima)
            {
                Primeira = Primeira.Prox;
                Primeira.Ant = null;
                Qtde--;
            }
        }

        public void Imprime()
        {
            CCelulaDup<T> aux = Primeira.Prox;
            while (aux != null)
            {
                Console.WriteLine(aux.Item);
                aux = aux.Prox;
            }
        }

        public T RetornaIndice(int Posicao)
        {
            if ((Posicao >= 1) && (Posicao <= Qtde) && (Primeira != Ultima))
            {
                CCelulaDup<T> aux = Primeira.Prox;
                for (int i = 1; i < Posicao; i++, aux = aux.Prox) ;
                if (aux != null)
                    return aux.Item;
            }
            return default(T);
        }

        public int Quantidade() => Qtde;

        public IEnumerator<T> GetEnumerator()
        {
            for (CCelulaDup<T> aux = Primeira.Prox; aux != null; aux = aux.Prox)
                yield return aux.Item;
        }

        IEnumerator IEnumerable.GetEnumerator() => GetEnumerator();

        public int primeiraOcorrenciaDe(T elemento){
            if (Qtde <= 0){
                return -1;
            }
            for (int a = 1; a <= Qtde; a++){
                if (RetornaIndice(a).Equals(elemento)){
                    return a;
                }
            }
            return -1;
        }

        public int ultimaOcorrenciaDe(T elemento){
            if (Qtde <= 0){
                return -1;
            }
            for (int a = Qtde; a >= 1; a--){
                if (RetornaIndice(a).Equals(elemento)){
                    return a;
                }
            }
            return -1;
        }
    }

    class Program{
        public static void Main(){
            CListaDup<int> lista = new CListaDup<int>();
            lista.InsereFim(10);
            lista.InsereFim(20);
            lista.InsereFim(30);
            lista.InsereFim(20);
            lista.InsereFim(40);
            int indice = lista.ultimaOcorrenciaDe(20);
            if (indice >= 0){
                Console.WriteLine("Última ocorrência está na posição "+indice);
            }
            else{
                Console.WriteLine("Não tem na lista");
            }
        }
    }
}